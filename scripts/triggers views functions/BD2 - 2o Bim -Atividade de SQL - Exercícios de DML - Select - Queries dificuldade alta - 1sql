--a

savepoint p7;

SELECT * FROM ITEM_PRODUTO;

SELECT  * FROM ESTOQUE E INNER JOIN PRODUTO P ON E.CODIGO_PRO = P.CODIGO ;

CREATE OR REPLACE VIEW VIEW_ESTOQUE AS
SELECT P.DESCRICAO AS PRODUTO,
NVL(QUANTIDADE_DISPONIVEL, 0) + NVL (QUANTIDADE_SAIDA, 0) AS QUANTIDADE_ADQUIRIDA,
NVL(QUANTIDADE_SAIDA,0) AS QUANTIDADE_SAIDA,
QUANTIDADE_DISPONIVEL AS DISPONIVEL, 
UNID_MEDIDA
FROM PRODUTO P LEFT JOIN (SELECT CODIGO_PRO, SUM (QUANTIDADE)AS QUANTIDADE_DISPONIVEL FROM ESTOQUE E GROUP BY CODIGO_PRO) D ON D.CODIGO_PRO = P.CODIGO
LEFT JOIN (SELECT IP.CODIGO_PRO, SUM(QUANTIDADE)AS QUANTIDADE_SAIDA FROM ITEM_PRODUTO IP GROUP BY IP.CODIGO_PRO) S ON P.CODIGO = S.CODIGO_PRO
ORDER BY CODIGO;  

SELECT * FROM VIEW_ESTOQUE;