/*BD2 - 2o Bim -Atividade de SQL - Exercícios de DML - Delete - Excluindo dados em
tabelas do Projeto Pedido*/

SAVEPOINT P4;

SELECT * FROM ITEM_PRODUTO WHERE NUMERO_PED IN (SELECT NUMERO FROM PEDIDO WHERE MOD(NUMERO, 2)=1 AND MATRICULA_VEN = 102 AND   CEP IS NOT NULL);
SELECT * FROM PEDIDO WHERE MOD(NUMERO, 2)=1 AND MATRICULA_VEN = 102 AND   CEP IS NOT NULL; 
--a
DELETE FROM ITEM_PRODUTO WHERE NUMERO_PED IN (SELECT NUMERO FROM PEDIDO WHERE MOD(NUMERO, 2)=1 AND MATRICULA_VEN = 102 AND   CEP IS NOT NULL);
DELETE FROM PEDIDO WHERE MOD(NUMERO, 2)=1 AND MATRICULA_VEN = 102 AND   CEP IS NOT NULL;

SAVEPOINT P5;

SELECT * FROM ITEM_PRODUTO WHERE NUMERO_PED IN (SELECT MIN(NUMERO_PED) FROM (SELECT * FROM ITEM_PRODUTO WHERE NUMERO_PED IN (SELECT  NUMERO FROM PEDIDO WHERE DATA IN (SELECT MAX(DATA) FROM PEDIDO))));

--b
DELETE FROM ITEM_PRODUTO WHERE NUMERO_PED IN (SELECT MIN(NUMERO_PED) FROM (SELECT * FROM ITEM_PRODUTO WHERE NUMERO_PED IN (SELECT  NUMERO FROM PEDIDO WHERE DATA IN (SELECT MAX(DATA) FROM PEDIDO))));
--c
ROLLBACK TO P5;
ROLLBACK TO P4;


