/*BD2 - 2o Bim -Atividade de SQL - Exercícios de DML - Update - Alterando dados na tabela
ITEM_PRODUTO do Projeto Pedido*/
SAVEPOINT P2;

SELECT * FROM ITEM_PRODUTO;

SELECT * FROM PEDIDO;

SELECT * FROM ITEM_PRODUTO WHERE ((NUMERO_PED <20) OR (NUMERO_PED>50)) AND ((CODIGO_PRO>202) AND (CODIGO_PRO<206));

SELECT A.NUMERO_PED, A.CODIGO_PRO, A.QUANTIDADE, B.CODIGO_CLI FROM (ITEM_PRODUTO A INNER JOIN PEDIDO B ON A.NUMERO_PED = B.NUMERO);

SELECT A.NUMERO_PED, B.CODIGO_CLI, B.MATRICULA_VEN, A.QUANTIDADE FROM ITEM_PRODUTO A INNER JOIN PEDIDO B ON A.NUMERO_PED=B.NUMERO
WHERE NUMERO_PED IN (
SELECT NUMERO FROM PEDIDO
WHERE MOD(CODIGO_CLI, 2) =1) AND NUMERO_PED IN (SELECT NUMERO FROM PEDIDO
WHERE MOD(MATRICULA_VEN, 2) =0);
--a
UPDATE ITEM_PRODUTO 
SET QUANTIDADE = QUANTIDADE*2
WHERE ((NUMERO_PED <20) OR (NUMERO_PED>50)) AND ((CODIGO_PRO>202) AND (CODIGO_PRO<206));

--b
UPDATE ITEM_PRODUTO
SET QUANTIDADE = QUANTIDADE+15
WHERE NUMERO_PED IN (
SELECT NUMERO FROM PEDIDO
WHERE MOD(CODIGO_CLI, 2) =1) AND NUMERO_PED IN (SELECT NUMERO FROM PEDIDO
WHERE MOD(MATRICULA_VEN, 2) =0);

--c
UPDATE ITEM_PRODUTO 
SET PRECO_UNITARIO = PRECO_UNITARIO - 0.50
WHERE MOD(NUMERO ,3)=0;

--d
UPDATE ITEM_PRODUTO
SET VALOR_ITEM = QUANTIDADE * PRECO_UNITARIO;

SELECT SUM(VALOR_ITEM) AS TOTAL FROM ITEM_PRODUTO GROUP BY NUMERO_PED;

SAVEPOINT P3;
--e
UPDATE PEDIDO
SET TOTAL_FATURA = (SELECT SUM(VALOR_ITEM) AS TOTAL FROM ITEM_PRODUTO WHERE NUMERO_PED=PEDIDO.NUMERO)

;