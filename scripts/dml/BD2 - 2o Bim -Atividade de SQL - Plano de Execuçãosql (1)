/*BD2 - 2o Bim -Atividade de SQL - Exercícios de DML - Select - Queries dificuldade alta*/

--a
EXPLAIN PLAN FOR SELECT NUMERO,
DATA,
TOTAL_FATURA AS TOTAL,
NOME AS CLIENTE,
CNPF,
CNPJ
FROM PEDIDO JOIN
VIEW_CLIENTE ON CODIGO_CLI=CODIGO
WHERE TOTAL_FATURA < 10000;

SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY);

--b
--CRIAR INDICE BASEADO NA COLUNA FATURA DA TABELA PEDIDO PARA FACILITAR A RECUPERAÇAO DE DADOS NA CLAUSULA WHERE


--c 
CREATE INDEX IND_FATURA_PE ON PEDIDO (TOTAL_FATURA DESC);

EXPLAIN PLAN FOR SELECT NUMERO,
DATA,
TOTAL_FATURA AS TOTAL,
NOME AS CLIENTE,
CNPF,
CNPJ
FROM PEDIDO  JOIN
VIEW_CLIENTE ON CODIGO_CLI=CODIGO
WHERE TOTAL_FATURA < 10000
;
SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY);

--d
--NAS PRIMEIRAS DUAS ETAPAS DO PLANO HOUVE UMA REDUÇAO DE 2% NO USO DA CPU (SAIU DE 14% PARA 12%)